<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Café Gestor</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#624e33", secondary: "#14160f", tertiary: "#77895b", "light-bg": "#f9f9f9", "card-bg": "#ffffff", "accent-bg": "#edf2ea", "dark-bg": "#14160f" },
            fontFamily: { sans: ["Plus Jakarta Sans", "sans-serif"] },
          },
        },
      };
    </script>
    <script>
      (function () {
        try {
          const savedState = localStorage.getItem("sidebarState") || "open";
          const isClosed = savedState === "closed";
          const style = document.createElement("style");

          // Este script faz DUAS coisas:
          // 1. Define a LARGURA do placeholder da sidebar.
          // 2. Define a MARGEM do conteúdo principal.
          style.textContent = `
        @media (min-width: 768px) {
          #sidebar-placeholder {
            width: ${isClosed ? "5rem" : "16rem"};
            transition: width 0.2s ease-in-out;
          }
          #main-content {
            transition: none !important; 
            margin-left: ${isClosed ? "5rem" : "16rem"};
          }
        }
      `;
          document.head.appendChild(style);
        } catch (e) {
          console.error("Falha ao aplicar o estilo anti-flicker:", e);
        }
      })();
    </script>
  </head>
  <body class="font-sans bg-light-bg leading-relaxed">
    <div class="flex min-h-screen">
      <div id="sidebar-placeholder" class="hidden md:flex flex-col bg-card-bg border-r border-gray-200"></div>

      <main id="main-content" class="flex-1 p-4 md:p-10 transition-all duration-200 ease-in-out">
        <h1 class="text-3xl md:text-4xl font-bold text-secondary mb-8">Dashboard</h1>
        <div class="grid grid-cols-1 mb-8">
          <div class="p-6 bg-card-bg rounded-lg shadow-sm border border-[#d6e5d1]">
            <h4 class="text-base font-medium text-tertiary">Vendas Totais do Dia</h4>
            <p class="text-3xl font-bold text-secondary mt-2">R$ 1.489,50</p>
            <p class="text-sm text-gray-500 mt-1">+15% em relação a ontem</p>
          </div>
        </div>
        <h2 class="text-2xl font-bold text-secondary mb-6">Pedidos Recentes</h2>
        <div class="bg-card-bg rounded-lg shadow-sm border border-[#d6e5d1] overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pedido</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                  <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                </tr>
              </thead>
              <tbody id="recent-orders-table" class="bg-card-bg divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <div
      id="order-details-modal"
      class="fixed inset-0 bg-gray-900 bg-opacity-50 hidden items-center justify-center p-4 z-50 transition-all duration-200 ease-in-out opacity-0 scale-95 flex"
    >
      <div class="relative bg-card-bg rounded-xl shadow-2xl w-full max-w-lg mx-auto flex flex-col max-h-[90vh]">
        <div class="flex justify-between items-center p-4 border-b border-gray-200">
          <h2 id="modal-order-title" class="text-xl font-semibold text-secondary">Detalhes do Pedido</h2>
          <button data-close-modal="order-details-modal" class="text-gray-500 hover:text-secondary text-2xl font-bold leading-none">&times;</button>
        </div>
        <div class="p-6 space-y-4 overflow-y-auto">
          <div>
            <p class="text-sm font-medium text-secondary mb-2">Itens do Pedido:</p>
            <div id="modal-order-items" class="space-y-3"></div>
          </div>
        </div>
        <div class="flex justify-between items-center p-4 bg-gray-50 rounded-b-xl border-t">
          <span class="text-base font-bold text-secondary">Total:</span>
          <span id="modal-order-total" class="text-xl font-bold text-tertiary"></span>
          <button data-close-modal="order-details-modal" class="bg-gray-200 text-gray-800 font-medium py-2 px-6 rounded-lg shadow-sm hover:bg-gray-300 transition-colors">
            Fechar
          </button>
        </div>
      </div>
    </div>

    <script src="scripts/components.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        loadSidebar();

        const recentOrders = [
          {
            id: "#8562",
            name: "Ana Clara",
            total: 42.5,
            items: [
              { qty: 1, name: "Latte de Baunilha", options: "Grande, Leite de Aveia", price: 14.0 },
              { qty: 2, name: "Pão de Queijo", options: "Doce de Leite (+R$ 3,00)", price: 9.0 },
            ],
          },
          {
            id: "#8561",
            name: "João Pedro",
            total: 18.0,
            items: [
              { qty: 1, name: "Bolo de Cenoura", options: "Com Sorvete (+R$ 4,00)", price: 12.5 },
              { qty: 1, name: "Café Expresso", options: "Pequeno", price: 5.5 },
            ],
          },
        ];

        const orderDetailsModal = document.getElementById("order-details-modal");

        function renderRecentOrders() {
          const tableBody = document.getElementById("recent-orders-table");
          if (!tableBody) return;
          tableBody.innerHTML = "";
          recentOrders.forEach((order) => {
            const row = document.createElement("tr");
            row.innerHTML = `<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-secondary">${
              order.id
            }</td><td class="px-6 py-4 whitespace-nowrap text-sm text-secondary font-medium">R$ ${order.total
              .toFixed(2)
              .replace(".", ",")}</td><td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium"><button data-order-id="${
              order.id
            }" class="view-details-btn text-primary hover:text-tertiary">Ver Detalhes</button></td>`;
            tableBody.appendChild(row);
          });
        }

        function populateOrderDetailsModal(orderId) {
          const order = recentOrders.find((o) => o.id === orderId);
          if (!order) return;
          document.getElementById("modal-order-title").textContent = `Detalhes do Pedido ${order.id}`;
          document.getElementById("modal-order-total").textContent = `R$ ${order.total.toFixed(2).replace(".", ",")}`;
          const itemsContainer = document.getElementById("modal-order-items");
          itemsContainer.innerHTML = "";
          order.items.forEach((item) => {
            const itemDiv = document.createElement("div");
            itemDiv.className = "flex justify-between items-start";
            itemDiv.innerHTML = `<div><p class="font-semibold text-secondary">${item.qty}x ${item.name}</p>${
              item.options ? `<p class="text-xs text-gray-500 pl-4">- ${item.options}</p>` : ""
            }</div><p class="font-medium text-secondary">R$ ${(item.qty * item.price).toFixed(2).replace(".", ",")}</p>`;
            itemsContainer.appendChild(itemDiv);
          });
          showModal(orderDetailsModal);
        }

        function showModal(modal) {
          modal.classList.remove("hidden");
          setTimeout(() => modal.classList.remove("opacity-0", "scale-95"), 10);
        }
        function hideModal(modal) {
          modal.classList.add("opacity-0", "scale-95");
          setTimeout(() => modal.classList.add("hidden"), 200);
        }

        const recentOrdersTable = document.getElementById("recent-orders-table");
        if (recentOrdersTable) {
          recentOrdersTable.addEventListener("click", (e) => {
            const detailsBtn = e.target.closest(".view-details-btn");
            if (detailsBtn) {
              populateOrderDetailsModal(detailsBtn.dataset.orderId);
            }
          });
        }
        document.querySelectorAll("[data-close-modal]").forEach((btn) => {
          const modal = document.getElementById(btn.dataset.closeModal);
          if (modal) btn.addEventListener("click", () => hideModal(modal));
        });
        renderRecentOrders();
      });
    </script>
  </body>
</html>
