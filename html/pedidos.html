<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pedidos - Café Gestor</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;700&display=swap" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: { primary: "#624e33", secondary: "#14160f", tertiary: "#77895b", "light-bg": "#f9f9f9", "card-bg": "#ffffff", "accent-bg": "#edf2ea", "dark-bg": "#14160f" },
            fontFamily: { sans: ["Plus Jakarta Sans", "sans-serif"] },
          },
        },
      };
    </script>
    <script>
      // Script Anti-Flicker para a Sidebar
      (function () {
        try {
          const savedState = localStorage.getItem("sidebarState") || "open";
          const style = document.createElement("style");

          // Aplica o CSS necessário ANTES da página ser renderizada
          // A transição é desativada para evitar uma animação estranha no carregamento
          style.textContent = `
        @media (min-width: 768px) {
          #main-content {
            transition: none !important; 
            margin-left: ${savedState === "closed" ? "5rem" : "16rem"};
          }
        }
      `;

          document.head.appendChild(style);
        } catch (e) {
          console.error("Falha ao aplicar o estilo anti-flicker:", e);
        }
      })();
    </script>
  </head>
  <body class="font-sans bg-light-bg leading-relaxed">
    <div class="flex min-h-screen">
      <div id="sidebar-placeholder"></div>

      <main id="main-content" class="flex-1 p-4 md:p-10 transition-all duration-200 ease-in-out">
        <h1 class="text-3xl md:text-4xl font-bold text-secondary mb-8">Todos os Pedidos</h1>
        <div class="mb-6">
          <label for="order-id-filter" class="block text-sm font-medium text-gray-700 mb-2">Filtrar por ID do Pedido:</label>
          <div class="relative">
            <div class="pointer-events-none absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path
                  fill-rule="evenodd"
                  d="M9 3.5a5.5 5.5 0 100 11 5.5 5.5 0 000-11zM2 9a7 7 0 1112.452 4.391l3.328 3.329a.75.75 0 11-1.06 1.06l-3.329-3.328A7 7 0 012 9z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <input
              type="search"
              id="order-id-filter"
              placeholder="Digite o ID, ex: #8562"
              class="block w-full md:w-80 rounded-lg border-gray-300 pl-10 py-2 focus:border-tertiary focus:ring-tertiary sm:text-sm"
            />
          </div>
        </div>
        <div class="bg-card-bg rounded-lg shadow-sm border border-[#d6e5d1] overflow-hidden">
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Pedido</th>
                  <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total</th>
                  <th scope="col" class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Ações</th>
                </tr>
              </thead>
              <tbody id="all-orders-table" class="bg-card-bg divide-y divide-gray-200"></tbody>
            </table>
          </div>
        </div>
      </main>
    </div>

    <script src="scripts/components.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        loadSidebar();

        // Em seguida, executa a lógica específica desta página
        const orderDetailsModal = document.getElementById("order-details-modal");

        function showModal(modal) {
          modal.classList.remove("hidden");
          setTimeout(() => modal.classList.remove("opacity-0", "scale-95"), 10);
        }
        function hideModal(modal) {
          modal.classList.add("opacity-0", "scale-95");
          setTimeout(() => modal.classList.add("hidden"), 200);
        }

        const allOrders = [
          {
            id: "#8562",
            name: "Ana Clara",
            total: 42.5,
            items: [
              { qty: 1, name: "Latte de Baunilha", options: "Grande, Leite de Aveia", price: 14.0 },
              { qty: 2, name: "Pão de Queijo", options: "Doce de Leite (+R$ 3,00)", price: 9.0 },
              { qty: 1, name: "Café Expresso", options: "Pequeno, Adoçante", price: 5.5 },
            ],
          },
          {
            id: "#8561",
            name: "João Pedro",
            total: 18.0,
            items: [
              { qty: 1, name: "Bolo de Cenoura", options: "Com Sorvete (+R$ 4,00)", price: 12.5 },
              { qty: 1, name: "Café Expresso", options: "Pequeno", price: 5.5 },
            ],
          },
          {
            id: "#8560",
            name: "Maria Silva",
            total: 25.75,
            items: [
              { qty: 1, name: "Iced Caramel Macchiato", options: "Leite de Coco", price: 15.0 },
              { qty: 1, name: "Pão de Queijo", options: "Tradicional", price: 6.0 },
              { qty: 1, name: "Água", options: "", price: 4.75 },
            ],
          },
          {
            id: "#8559",
            name: "Lucas Souza",
            total: 55.2,
            items: [
              { qty: 2, name: "Latte de Baunilha", options: "Grande", price: 14.0 },
              { qty: 3, name: "Pão de Queijo", options: "Tradicional", price: 6.0 },
              { qty: 1, name: "Bolo de Cenoura", options: "", price: 8.5 },
            ],
          },
          { id: "#8558", name: "Beatriz Lima", total: 12.5, items: [{ qty: 1, name: "Bolo de Cenoura", options: "Com Sorvete (+R$ 4,00)", price: 12.5 }] },
          {
            id: "#8557",
            name: "Carlos Andrade",
            total: 21.5,
            items: [
              { qty: 1, name: "Café Expresso", options: "Duplo", price: 9.5 },
              { qty: 1, name: "Pão de Queijo", options: "Tradicional", price: 6.0 },
              { qty: 1, name: "Pão de Queijo", options: "Tradicional", price: 6.0 },
            ],
          },
          {
            id: "#8556",
            name: "Fernanda Costa",
            total: 35.0,
            items: [
              { qty: 2, name: "Iced Caramel Macchiato", options: "", price: 15.0 },
              { qty: 1, name: "Café Expresso", options: "Pequeno", price: 5.0 },
            ],
          },
        ];

        function renderOrdersTable(ordersToRender) {
          const tableBody = document.getElementById("all-orders-table");
          if (!tableBody) return;
          tableBody.innerHTML = "";

          if (ordersToRender.length === 0) {
            tableBody.innerHTML = `<tr><td colspan="3" class="text-center py-10 text-gray-500">Nenhum pedido encontrado.</td></tr>`;
            return;
          }

          ordersToRender.forEach((order) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                      <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-secondary">${order.id}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-sm text-secondary font-medium">R$ ${order.total.toFixed(2).replace(".", ",")}</td>
                      <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <button data-order-id="${order.id}" class="view-details-btn text-primary hover:text-tertiary">Ver Detalhes</button>
                      </td>`;
            tableBody.appendChild(row);
          });
        }

        function populateOrderDetailsModal(orderId) {
          const order = allOrders.find((o) => o.id === orderId);
          if (!order) return;

          document.getElementById("modal-order-title").textContent = `Detalhes do Pedido ${order.id}`;
          document.getElementById("modal-order-total").textContent = `R$ ${order.total.toFixed(2).replace(".", ",")}`;

          const itemsContainer = document.getElementById("modal-order-items");
          itemsContainer.innerHTML = "";

          order.items.forEach((item) => {
            const itemDiv = document.createElement("div");
            itemDiv.className = "flex justify-between items-start";
            itemDiv.innerHTML = `
                      <div>
                          <p class="font-semibold text-secondary">${item.qty}x ${item.name}</p>
                          ${item.options ? `<p class="text-xs text-gray-500 pl-4">- ${item.options}</p>` : ""}
                      </div>
                      <p class="font-medium text-secondary">R$ ${(item.qty * item.price).toFixed(2).replace(".", ",")}</p>`;
            itemsContainer.appendChild(itemDiv);
          });
          showModal(orderDetailsModal);
        }

        const allOrdersTable = document.getElementById("all-orders-table");
        if (allOrdersTable) {
          allOrdersTable.addEventListener("click", (e) => {
            const detailsBtn = e.target.closest(".view-details-btn");
            if (detailsBtn) {
              populateOrderDetailsModal(detailsBtn.dataset.orderId);
            }
          });
        }

        const orderFilterInput = document.getElementById("order-id-filter");
        if (orderFilterInput) {
          orderFilterInput.addEventListener("input", () => {
            const searchTerm = orderFilterInput.value.toLowerCase().trim();
            const filteredOrders = allOrders.filter((order) => order.id.toLowerCase().includes(searchTerm));
            renderOrdersTable(filteredOrders);
          });
        }

        document.querySelectorAll("[data-close-modal]").forEach((btn) => {
          const modal = document.getElementById(btn.dataset.closeModal);
          if (modal) btn.addEventListener("click", () => hideModal(modal));
        });

        renderOrdersTable(allOrders);
      });
    </script>
  </body>
</html>
